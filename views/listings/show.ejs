<% layout("/layouts/boilerplate") %>

  <body>
    <div class="row mt-2">
      <div class="col-6 offset-3">
        <h3>
          <%= listing.title %>
        </h3>
        <div class="card">
          <img src="<%= listing.image %>" class="card-img-top" alt="listing_image">
          <div class="card-body">

            <ul class="card-text">
              <li>
                <i class="fa-solid fa-user"></i> <b>
                  @<%= listing.owner.username %>
                </b>
              </li> <br>
              <li>
                <%= listing.description %>
              </li> <br>
              <li><b>Price</b>: &#8377;<%= listing.price.toLocaleString("EN-IN")%>
              </li>
              <li><b>Location</b>: <%= listing.location %>
              </li>
              <li><b>Country</b>: <%= listing.country %>
              </li>
            </ul>

          </div>
          <% if(currentUser && currentUser._id.equals(listing.owner._id)) { %>
            <form method="GET" action="/listings/<%= listing._id %>/edit">
              <button class="btn btn-light btn-show">Edit</button>
            </form>
            <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE">
              <button class="btn btn-dark btn-show">Delete</button>
            </form>
            <% } %>
        </div>

        <hr>

        <% if(currentUser) { %>

          <h3>Add a review</h3>

          <form class="needs-validation" method="POST" action="/listings/<%= listing._id %>/reviews" class="mt-3"
            novalidate>
            <div class="mt-3 mb-3">
              <label for="rating" class="form-label fw-semibold">Rating: </label>
              <input class="form-range" id="rating" name="review[rating]" type="range" min="1" max="5" required>
            </div>

            <div class="mb-3">
              <label for="rating" class="form-label fw-semibold">Comment</label>
              <textarea class="form-control" name="review[comment]" id="comment" cols="30" rows="4" required></textarea>
              <div class="invalid-feedback">
                Comment cannot be empty.
              </div>
            </div>

            <button class="btn btn-sm btn-dark">Submit</button>

          </form>

          <hr>
          <% } %>

            <% if(listing.reviews.length!=0) { %>
              <h4>All Reviews</h4>
              <% } else { %>
                <h4>No Reviews yet</h4>
                <% } %>
                  <div class="row mt-2">
                    <% for(review of listing.reviews) { %>
                      <div class="card col-5 ms-2 mb-2 p-1">
                        <div class="card-body">
                          <h5 class="card-title">
                            @<%= review.author.username %>
                          </h5>
                          <p class="card-text">
                            <%= review.comment %>
                          </p>
                          <p class="card-text">
                            <%= review.rating %> stars
                          </p>
                          <form method="POST"
                            action="/listings/<%= listing._id %>/reviews/<%= review._id%>?_method=DELETE">
                            <button class="btn btn-light"><i class="fa-solid fa-trash"></i></button>
                          </form>
                        </div>
                      </div>

                      <% } %>
                  </div>

      </div>
    </div>


  </body>